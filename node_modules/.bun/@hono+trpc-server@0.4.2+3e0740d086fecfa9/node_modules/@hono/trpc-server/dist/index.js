import { fetchRequestHandler } from "@trpc/server/adapters/fetch";
import { routePath } from "hono/route";

//#region src/index.ts
const trpcServer = ({ endpoint, createContext,...rest }) => {
	const bodyProps = new Set([
		"arrayBuffer",
		"blob",
		"formData",
		"json",
		"text"
	]);
	return async (c) => {
		const canWithBody = c.req.method === "GET" || c.req.method === "HEAD";
		let resolvedEndpoint = endpoint;
		if (!endpoint) {
			const path = routePath(c);
			if (path) resolvedEndpoint = path.replace(/\/\*+$/, "") || "/trpc";
			else resolvedEndpoint = "/trpc";
		}
		return await fetchRequestHandler({
			...rest,
			createContext: async (opts) => ({
				...createContext ? await createContext(opts, c) : {},
				env: c.env
			}),
			endpoint: resolvedEndpoint,
			req: canWithBody ? c.req.raw : new Proxy(c.req.raw, { get(t, p, _r) {
				if (bodyProps.has(p)) return () => c.req[p]();
				return Reflect.get(t, p, t);
			} })
		});
	};
};

//#endregion
export { trpcServer };
//# sourceMappingURL=index.js.map